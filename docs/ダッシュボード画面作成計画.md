# ダッシュボード画面作成計画書

## 1. プロジェクト概要

### 目的
佐渡ヶ島お祭りアプリのダッシュボード機能を、要件定義書に従って正確に実装する。

### 成果物
- Dashboard.tsx（メインコンポーネント）
- Dashboard.scss（スタイルシート）
- EventCard.tsx（イベントカードコンポーネント）
- EventModal.tsx（詳細モーダルコンポーネント）
- MapView.tsx（地図表示コンポーネント）

## 2. 設計方針

### 2.1. コンポーネント構成
```
Dashboard
├── EventGrid（イベント一覧）
│   └── EventCard（個別イベントカード）
├── MapView（地図表示）
└── EventModal（詳細モーダル）
```

### 2.2. データフロー
1. **CSVデータ取得**: App.tsxから受け取ったshopListを使用
2. **フィルタリング**: 開催ステータス="開催予定"のイベントのみ表示
3. **ソート**: 開催日の近い順 → 規模感の大きい順 → 名称順
4. **状態管理**: 選択されたイベント、モーダル表示状態、地図ピン位置

### 2.3. インタラクション設計
- **1回タップ**: 地図にピン表示 + カード選択状態
- **2回タップ**: 詳細モーダル表示
- **タップ判定**: `lastClickedCardId`による同一カード判定（サンプルコード方式を採用）

## 3. 実装計画

### Phase 1: 基盤コンポーネント作成
1. **Dashboard.tsx**
   - レイアウト構造の実装
   - データ受け取りとフィルタリング
   - 状態管理の設定

2. **EventCard.tsx**
   - カード表示内容の実装
   - タップイベント処理
   - 選択状態の視覚的フィードバック

### Phase 2: 地図機能実装
3. **MapView.tsx**
   - Google Maps埋め込み
   - 静的ピン表示機能
   - 佐渡島全体表示の初期設定

### Phase 3: モーダル機能実装
4. **EventModal.tsx**
   - 詳細情報表示
   - 閉じるボタン機能
   - 外部リンク処理

### Phase 4: スタイリング
5. **Dashboard.scss**
   - 2/3 + 1/3 レイアウト
   - 2列グリッド
   - モバイルファーストデザイン

## 4. 技術仕様

### 4.1. 使用技術
- React 18 + TypeScript
- Google Maps Embed API
- CSS Grid / Flexbox
- React Hooks (useState, useEffect, useCallback)

### 4.2. データ型定義
```typescript
interface DashboardEvent {
  id: number;
  name: string;
  description: string;
  location_name: string;
  address: string;
  latitude: number;
  longitude: number;
  start_date: string;
  end_date: string;
  start_time: string;
  end_time: string;
  is_free: boolean;
  has_parking: boolean;
  has_food_stalls: boolean;
  top_category: string;
  tags: string[];
  status: string;
  image_urls: string[];
  official_link: string;
  highlights: string;
  access_info: string;
}

interface DashboardState {
  selectedEvent: DashboardEvent | null;
  showModal: boolean;
  lastClickedCardId: number | null;
}
```

### 4.3. 地図実装仕様（サンプルコード分析結果）
- **Google Maps Embed API**: `https://www.google.com/maps/embed/v1/view`
- **固定中心座標**: `center=38.0195,138.2570&zoom=10`
- **ピン表示方式**: CSS絶対位置指定による静的ピン
- **ピン計算式**: 
  ```javascript
  const pixelsPerDegreeLat = mapHeight / (180 / Math.pow(2, zoomLevel - 1));
  const pixelsPerDegreeLng = mapWidth / (360 / Math.pow(2, zoomLevel - 1));
  const pinTop = (mapCenterLat - event.latitude) * pixelsPerDegreeLat + mapHeight / 2;
  const pinLeft = (event.longitude - mapCenterLng) * pixelsPerDegreeLng + mapWidth / 2;
  ```

### 4.4. レスポンシブ対応
- **モバイル**: 2列グリッド（サンプルコード準拠）
- **画面比率**: 上部2/3（イベント一覧）+ 下部1/3（地図）
- **カード画像**: 固定高さ100px、object-fit: cover

## 5. 品質保証

### 5.1. テスト項目
- [ ] イベントカードの正常表示
- [ ] 1回タップでピン表示
- [ ] 2回タップでモーダル表示
- [ ] 地図の初期表示位置
- [ ] モーダルの閉じる機能
- [ ] レスポンシブデザイン

### 5.2. パフォーマンス要件
- 初期表示: 2秒以内
- タップ反応: 100ms以内
- 地図読み込み: 3秒以内

## 6. 実装順序（サンプルコード分析完了）

### Step 1: 設計確認とサンプルコード分析 ✅
- **完了**: HTMLとJavaScriptサンプルコード分析
- **判明事項**:
  - TailwindCSSベースのスタイリング
  - Google Maps Embed API使用
  - 静的ピン表示（CSS絶対位置）
  - lastClickedCardId方式のタップ判定
  - 2/3 + 1/3 レイアウト構成

### Step 2: 既存システムとの整合性確認
- App.tsxのshopListデータ構造との対応関係確認
- 既存のCSS変数・スタイルとの統合方針決定
- TypeScript型定義の調整

### Step 3: コンポーネント実装
1. **Dashboard.tsx**（メインコンテナ）
2. **EventCard.tsx**（個別カード + タップ処理）
3. **MapView.tsx**（地図表示 + ピン制御）
4. **EventModal.tsx**（詳細モーダル）

### Step 4: スタイリング
- Dashboard.scss の実装（TailwindCSS → SCSS変換）
- 既存デザインシステムとの統合

### Step 5: 統合テスト
- 全機能の動作確認
- 既存システムとの連携テスト

## 7. 注意事項

### 7.1. 既存システムとの整合性
- App.tsxのshopListデータ構造を維持
- 既存のタブバー構造との連携
- 既存のCSS変数・クラス名の活用

### 7.2. Google Maps API（サンプルコード分析結果）
- **埋め込み形式**: Google Maps Embed API使用（JavaScript APIは不使用）
- **APIキー**: サンプルコードのキー `AIzaSyB4VEihrycQJKeszHDh3Epy1rFVHpaT_70` を参考
- **ピン表示**: CSS絶対位置指定による静的ピン（地図APIのマーカー機能は不使用）
- **座標計算**: ピクセル座標変換式をJavaScriptからTypeScriptに移植

### 7.3. アクセシビリティ
- キーボードナビゲーション対応
- スクリーンリーダー対応
- 適切なARIA属性の設定

## 8. 完了条件

- [ ] 要件定義書の全機能が実装されている
- [ ] TypeScriptエラーが0件
- [ ] ESLintエラーが0件
- [ ] レスポンシブデザインが正常に動作
- [ ] 全ブラウザで動作確認完了
- [ ] パフォーマンス要件を満たしている

---

**重要**: この計画書は実装前に必ずユーザーの承認を得ること。サンプルコード分析後に詳細を調整する可能性がある。