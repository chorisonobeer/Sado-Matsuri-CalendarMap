# 佐渡ヶ島お祭り案内アプリ 改修計画書

## 1. 改修概要

### 1.1 改修目的
**新潟クラフトビールマップ** から **佐渡ヶ島お祭り案内アプリ** への全面改修

### 1.2 主要変更点
- **ドメイン変更**: クラフトビール → お祭り・イベント情報
- **UI/UX刷新**: カレンダービュー追加、ダッシュボード改修
- **データ構造変更**: 店舗データ → イベントデータ
- **機能追加**: カレンダー表示、イベント重み付け、タグフィルター強化

## 2. 差分分析

### 2.1 保持可能な既存機能
✅ **技術スタック**: React + TypeScript + SCSS  
✅ **PWA機能**: Service Worker, Manifest  
✅ **地図機能**: Geolonia Maps（位置は佐渡島に変更）  
✅ **データ取得**: Papa Parse + CSV  
✅ **キャッシュ機構**: sessionStorage  
✅ **レスポンシブ対応**: モバイルファースト  

### 2.2 大幅改修が必要な機能
🔄 **メインコンテンツ**: 店舗 → イベント  
🔄 **ナビゲーション**: タブ構成変更  
🔄 **検索・フィルター**: タグベース強化  
🔄 **データ表示**: カード形式の内容変更  

### 2.3 新規実装が必要な機能
🆕 **カレンダービュー**: 月/週/日表示  
🆕 **ダッシュボード**: 直近イベント表示  
🆕 **イベント重み付け**: 優先度ソート  
🆕 **タグフィルター**: 横スクロールカルーセル  
🆕 **モーダル詳細**: 日付タップ時のイベント一覧  

## 3. 詳細改修計画

### 3.1 フェーズ1: 基盤改修（優先度: 高）

#### 3.1.1 設定・データ構造変更
**対象ファイル**: 
- `src/config.json`
- `src/types.d.ts`

**変更内容**:
```json
// config.json
{
  "title": "佐渡ヶ島お祭り案内",
  "description": "佐渡ヶ島のお祭り・イベント情報をお届けします",
  "data_url": "佐渡イベント用GoogleスプレッドシートURL",
  "primary_color": "#4338ca", // 要件定義書指定色
  "background_color": "#f0f4f8" // 要件定義書指定色
}
```

**型定義追加**:
```typescript
// types.d.ts に追加
type FestivalData = {
  index: number;
  イベント名: string;
  開催期間: string;
  開始日: string;
  終了日: string;
  開始時間?: string;
  終了時間?: string;
  場所: string;
  説明文: string;
  タグ: string;
  重み付け: number; // 新規追加
  画像URL?: string;
  緯度?: string;
  経度?: string;
}
```

#### 3.1.2 メインアプリケーション改修
**対象ファイル**: `src/App.tsx`

**変更内容**:
- `shopList` → `eventList` に変数名変更
- データ取得URLを佐渡イベント用に変更
- ソートロジック追加（日付 + 重み付け）

#### 3.1.3 ナビゲーション改修
**対象ファイル**: `src/App/Tabbar.tsx`

**変更前**:
```
ホーム | 一覧 | 写真から探す | イベント | マップについて
```

**変更後**:
```
ダッシュボード | 地図 | リスト | カレンダー | 情報
```

### 3.2 フェーズ2: UI/UX改修（優先度: 高）

#### 3.2.1 ダッシュボード新規作成
**新規ファイル**: `src/App/Dashboard.tsx`

**機能**:
- 直近開催予定イベントをカード表示
- 「今日・今週末何がある？」に対応
- フィルター初期値として機能

**実装方針**:
```typescript
const Dashboard = () => {
  const upcomingEvents = useMemo(() => {
    const now = new Date();
    const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
    return eventList
      .filter(event => {
        const eventDate = new Date(event.開始日);
        return eventDate >= now && eventDate <= nextWeek;
      })
      .sort((a, b) => {
        // 日付優先、次に重み付け
        const dateA = new Date(a.開始日);
        const dateB = new Date(b.開始日);
        if (dateA.getTime() !== dateB.getTime()) {
          return dateA.getTime() - dateB.getTime();
        }
        return b.重み付け - a.重み付け;
      });
  }, [eventList]);
  
  return (
    <div className="dashboard">
      <h2>今週のお祭り</h2>
      {upcomingEvents.map(event => (
        <EventCard key={event.index} event={event} />
      ))}
    </div>
  );
};
```

#### 3.2.2 カレンダービュー新規作成
**新規ファイル**: `src/App/Calendar.tsx`

**機能**:
- 月表示（週・日は将来実装）
- 複数日イベントの棒表示
- 日付タップ → モーダル表示
- タグフィルター連動

**実装方針**:
```typescript
const Calendar = () => {
  const [currentDate, setCurrentDate] = useState(new Date());
  const [selectedDate, setSelectedDate] = useState<Date | null>(null);
  const [filteredEvents, setFilteredEvents] = useState<FestivalData[]>([]);
  
  const monthEvents = useMemo(() => {
    // 月内のイベントを取得・整理
    return getEventsInMonth(currentDate, filteredEvents);
  }, [currentDate, filteredEvents]);
  
  const handleDateClick = (date: Date) => {
    setSelectedDate(date);
    // モーダル表示
  };
  
  return (
    <div className="calendar">
      <CalendarHeader date={currentDate} onDateChange={setCurrentDate} />
      <CalendarGrid events={monthEvents} onDateClick={handleDateClick} />
      {selectedDate && (
        <EventModal 
          date={selectedDate} 
          events={getEventsForDate(selectedDate, filteredEvents)}
          onClose={() => setSelectedDate(null)}
        />
      )}
    </div>
  );
};
```

#### 3.2.3 ハイブリッドビュー改修
**対象ファイル**: `src/App/Home.tsx`

**変更内容**:
- 地図とリストの切り替え機能追加
- 上部に検索ボックス + タグフィルター配置
- 初期表示を「直近開催予定」に設定

### 3.3 フェーズ3: 検索・フィルター強化（優先度: 中）

#### 3.3.1 タグフィルター強化
**対象ファイル**: `src/App/SearchFeature.tsx`

**追加機能**:
- 横スクロール可能なタグカルーセル
- 複数タグ選択対応
- ペルソナ対応キーワード（#花火、#鬼太鼓等）

**実装方針**:
```typescript
const TagFilter = ({ onTagChange }: { onTagChange: (tags: string[]) => void }) => {
  const [selectedTags, setSelectedTags] = useState<string[]>([]);
  const availableTags = ['花火', '鬼太鼓', '伝統芸能', 'グルメ', '出店', 'デート'];
  
  return (
    <div className="tag-filter-carousel">
      {availableTags.map(tag => (
        <TagButton 
          key={tag}
          tag={tag}
          selected={selectedTags.includes(tag)}
          onClick={() => toggleTag(tag)}
        />
      ))}
    </div>
  );
};
```

#### 3.3.2 イベント重み付けソート
**対象ファイル**: `src/App/List.tsx`

**実装内容**:
```typescript
const sortEvents = (events: FestivalData[]) => {
  return events.sort((a, b) => {
    // 1. 日付優先
    const dateA = new Date(a.開始日);
    const dateB = new Date(b.開始日);
    const dateDiff = dateA.getTime() - dateB.getTime();
    
    if (Math.abs(dateDiff) > 24 * 60 * 60 * 1000) { // 1日以上差がある
      return dateDiff;
    }
    
    // 2. 重み付け優先
    const weightDiff = b.重み付け - a.重み付け;
    if (weightDiff !== 0) {
      return weightDiff;
    }
    
    // 3. あいうえお順
    return a.イベント名.localeCompare(b.イベント名, 'ja');
  });
};
```

### 3.4 フェーズ4: デザイン・スタイル改修（優先度: 中）

#### 3.4.1 カラーパレット変更
**対象ファイル**: 全SCSS ファイル

**変更内容**:
```scss
// 新しいカラーパレット
$primary-color: #4338ca;      // 要件定義書指定
$background-color: #f0f4f8;   // 要件定義書指定
$accent-color: #6366f1;       // プライマリーの明るいバリエーション
$text-color: #1f2937;         // ダークグレー
$border-color: #e5e7eb;       // ライトグレー
```

#### 3.4.2 フォント変更
**対象ファイル**: `public/fonts.css`, 各SCSSファイル

**変更内容**:
- BIZ UDPGothic → Inter
- Google Fonts から読み込み

#### 3.4.3 UI要素の角丸統一
**対象ファイル**: 全SCSSファイル

**変更内容**:
```scss
// 統一的な角丸設定
$border-radius-sm: 8px;
$border-radius-md: 12px;
$border-radius-lg: 16px;
$border-radius-xl: 24px;

.card, .button, .modal, .input {
  border-radius: $border-radius-md;
}
```

### 3.5 フェーズ5: 地図機能調整（優先度: 低）

#### 3.5.1 地図中心位置変更
**対象ファイル**: `src/App/Map.tsx`

**変更内容**:
```typescript
// 新潟県中心 → 佐渡島中心
const SADO_CENTER: [number, number] = [138.3, 38.0]; // 佐渡島の中心座標
const DEFAULT_ZOOM = 10; // 佐渡島全体が見える程度
```

#### 3.5.2 マーカーデザイン変更
**対象ファイル**: `src/App/Map.tsx`

**変更内容**:
- クラフトビール用アイコン → お祭り用アイコン
- カラー調整（プライマリーカラーに合わせる）

## 4. 実装優先順位

### 4.1 Phase 1（必須・即座に実装）
1. **設定・データ構造変更** (1-2日)
2. **メインアプリケーション改修** (2-3日)
3. **ナビゲーション改修** (1日)

### 4.2 Phase 2（コア機能・1週間以内）
1. **ダッシュボード新規作成** (3-4日)
2. **カレンダービュー新規作成** (4-5日)
3. **ハイブリッドビュー改修** (2-3日)

### 4.3 Phase 3（機能強化・2週間以内）
1. **タグフィルター強化** (2-3日)
2. **イベント重み付けソート** (1-2日)
3. **検索機能調整** (1-2日)

### 4.4 Phase 4（デザイン・3週間以内）
1. **カラーパレット変更** (1-2日)
2. **フォント変更** (1日)
3. **UI要素統一** (2-3日)

### 4.5 Phase 5（最適化・4週間以内）
1. **地図機能調整** (1-2日)
2. **パフォーマンス最適化** (1-2日)
3. **最終テスト・調整** (2-3日)

## 5. リスク・課題

### 5.1 技術的リスク
- **カレンダーライブラリ**: 複雑な日付処理が必要
- **データ移行**: 既存キャッシュとの互換性
- **地図API**: 佐渡島の詳細地図データ品質

### 5.2 UX/UI リスク
- **カレンダーUI**: モバイルでの操作性
- **タグフィルター**: 横スクロールの使いやすさ
- **情報密度**: 小画面での情報表示バランス

### 5.3 データ品質リスク
- **イベント情報**: 正確性・最新性の担保
- **重み付け**: 適切な基準設定
- **位置情報**: 緯度経度の精度

## 6. 成功指標

### 6.1 機能面
- [ ] 全3つのビュー（ダッシュボード・地図・カレンダー）が正常動作
- [ ] タグフィルターが全ビューで連動
- [ ] イベント重み付けソートが適切に機能
- [ ] モバイル・デスクトップ両対応

### 6.2 パフォーマンス面
- [ ] 初期ロード時間 < 3秒
- [ ] カレンダー切り替え < 1秒
- [ ] 検索・フィルター反応 < 0.5秒

### 6.3 UX面
- [ ] 直感的なナビゲーション
- [ ] ペルソナのユースケースに対応
- [ ] エラー・ローディング状態の適切な表示

## 7. 移行計画

### 7.1 データ移行
1. **新しいGoogleスプレッドシート作成**
2. **サンプルデータ投入・テスト**
3. **本番データ移行**

### 7.2 段階的リリース
1. **開発環境**: 各フェーズ完了時
2. **ステージング環境**: Phase 2完了時
3. **本番環境**: 全フェーズ完了時

### 7.3 ユーザー通知
- **メンテナンス告知**: 改修開始1週間前
- **新機能案内**: リリース時
- **フィードバック収集**: リリース後1週間

---

**策定日**: 2025年1月20日  
**策定者**: システム改修計画AI  
**想定工期**: 4週間  
**想定工数**: 約80-100時間