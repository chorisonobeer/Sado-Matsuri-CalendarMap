# 検索タブ修正計画書

## 概要
現在の「地図」「リスト」タブを「検索」タブに統合し、参考HTML（`検索・フィルタリング ハイブリッド画面参考HTML.html`）に基づく統合検索画面を実装する。

## 現状の問題点

### 1. タブ構成の問題
- **現状**: タブバーに「地図」「リスト」が独立したタブとして存在
- **要件**: 「検索」タブ内での地図/リスト表示切り替え機能

### 2. 機能分散の問題
- **現状**: 検索機能が各画面に分散
- **要件**: 統合された検索画面（検索ボックス + タグフィルター + 表示切り替え）

### 3. ルーティング構造の問題
- **現状**: `/map`と`/list`が独立したルート
- **要件**: `/search`ルート内での状態管理

## 修正計画

### Phase 1: タブバー構造の修正
**ファイル**: `src/components/Tabbar.tsx`

#### 修正内容
- 「地図」「リスト」タブを削除
- 「検索」タブを追加（適切なアイコンと共に）
- ルーティングを`/search`に設定

#### 実装詳細
```typescript
// 修正前のタブ構成
const tabs = [
  { name: 'ダッシュボード', path: '/', icon: HomeIcon },
  { name: '地図', path: '/map', icon: MapIcon },      // 削除対象
  { name: 'リスト', path: '/list', icon: ListIcon },  // 削除対象
  { name: 'カレンダー', path: '/calendar', icon: CalendarIcon },
  { name: '情報', path: '/info', icon: InfoIcon }
];

// 修正後のタブ構成
const tabs = [
  { name: 'ダッシュボード', path: '/', icon: HomeIcon },
  { name: '検索', path: '/search', icon: SearchIcon },  // 新規追加
  { name: 'カレンダー', path: '/calendar', icon: CalendarIcon },
  { name: '情報', path: '/info', icon: InfoIcon }
];
```

### Phase 2: 統合検索コンポーネントの作成
**ファイル**: `src/components/SearchView.tsx`

#### 参考HTMLから移植する機能
1. **検索ボックス**
   - プレースホルダー: "イベントを検索..."
   - リアルタイム検索機能

2. **タグフィルター**
   - 地域タグ（佐渡市、両津、相川、金井、新穂、畑野、真野、小木、羽茂）
   - カテゴリタグ（祭り、文化、自然、グルメ、体験）
   - 複数選択可能
   - 選択状態の視覚的表示

3. **地図/リスト切り替えタブ**
   - 「地図」「リスト」の内部タブ
   - 切り替え時のスムーズなトランジション

4. **地図表示機能**
   - Google Maps JavaScript API
   - イベントマーカー表示
   - マーカークリック時の情報ウィンドウ

5. **リスト表示機能**
   - イベントカードのグリッド表示
   - カード内容：画像、タイトル、日付、場所、説明
   - カードクリック時のモーダル表示

6. **モーダルウィンドウ**
   - イベント詳細情報表示
   - 画像、詳細説明、開催情報
   - 閉じるボタン、背景クリックで閉じる

#### コンポーネント構造
```
SearchView/
├── SearchView.tsx          // メインコンポーネント
├── SearchView.scss         // スタイル定義
├── components/
│   ├── SearchBox.tsx       // 検索ボックス
│   ├── TagFilter.tsx       // タグフィルター
│   ├── ViewToggle.tsx      // 地図/リスト切り替え
│   ├── MapDisplay.tsx      // 地図表示
│   ├── ListDisplay.tsx     // リスト表示
│   └── EventModal.tsx      // イベント詳細モーダル
└── hooks/
    ├── useSearch.ts        // 検索ロジック
    ├── useFilter.ts        // フィルタリングロジック
    └── useMapData.ts       // 地図データ管理
```

### Phase 3: ルーティング修正
**ファイル**: `src/App.tsx`

#### 修正内容
- `/map`と`/list`ルートを削除
- `/search`ルートを追加し、`SearchView`コンポーネントを割り当て
- 既存の`HybridView`コンポーネントとの統合検討

#### 実装詳細
```typescript
// 修正前
<Route path="/map" element={<HybridView />} />
<Route path="/list" element={<HybridView />} />

// 修正後
<Route path="/search" element={<SearchView />} />
```

### Phase 4: 状態管理の統合
**ファイル**: 各種状態管理ファイル

#### 統合する状態
- 検索クエリ
- 選択されたタグフィルター
- 地図/リスト表示モード
- フィルタリング結果
- 選択されたイベント

#### Context/Store構造
```typescript
interface SearchState {
  searchQuery: string;
  selectedTags: string[];
  viewMode: 'map' | 'list';
  filteredEvents: Event[];
  selectedEvent: Event | null;
  isModalOpen: boolean;
}
```

### Phase 5: スタイリング
**ファイル**: `src/components/SearchView.scss`

#### 参考HTMLから移植するスタイル
- レスポンシブデザイン
- タグフィルターのボタンスタイル
- 地図/リスト切り替えタブのスタイル
- イベントカードのレイアウト
- モーダルウィンドウのスタイル

## 実装順序

### Step 1: 基盤準備
1. `SearchView.tsx`の基本構造作成
2. 必要な型定義の追加
3. 基本的なスタイルファイル作成

### Step 2: 検索機能実装
1. `SearchBox`コンポーネント作成
2. `TagFilter`コンポーネント作成
3. 検索・フィルタリングロジック実装

### Step 3: 表示機能実装
1. `ViewToggle`コンポーネント作成
2. `MapDisplay`コンポーネント作成（既存の地図機能を移植）
3. `ListDisplay`コンポーネント作成

### Step 4: モーダル機能実装
1. `EventModal`コンポーネント作成
2. モーダル表示ロジック実装

### Step 5: 統合・調整
1. `Tabbar.tsx`の修正
2. `App.tsx`のルーティング修正
3. 既存コンポーネントとの統合調整

### Step 6: テスト・最適化
1. TypeScriptエラーチェック
2. 機能テスト
3. レスポンシブデザインの確認
4. パフォーマンス最適化

## 注意事項

### 既存機能の保持
- 現在の地図機能（Google Maps API）を維持
- 既存のイベントデータ構造を維持
- フィルタリング機能の互換性を保持

### パフォーマンス考慮
- 地図の遅延読み込み
- 大量データのページネーション
- 検索結果のキャッシュ

### アクセシビリティ
- キーボードナビゲーション対応
- スクリーンリーダー対応
- 適切なARIA属性の設定

## 完了基準

### 機能要件
- [ ] 統合された検索画面の表示
- [ ] 検索ボックスによるリアルタイム検索
- [ ] タグフィルターによる絞り込み
- [ ] 地図/リスト表示の切り替え
- [ ] イベント詳細モーダルの表示
- [ ] レスポンシブデザインの対応

### 技術要件
- [ ] TypeScriptエラーなし
- [ ] ESLintエラーなし
- [ ] 既存機能の動作確認
- [ ] パフォーマンステスト合格

### UI/UX要件
- [ ] 参考HTMLと同等のデザイン
- [ ] スムーズなアニメーション
- [ ] 直感的な操作性
- [ ] モバイル対応

## リスク・課題

### 技術的リスク
- Google Maps APIの統合複雑性
- 既存コンポーネントとの競合
- 状態管理の複雑化

### 対応策
- 段階的な実装とテスト
- 既存機能の詳細調査
- バックアップ計画の準備

---

**作成日**: 2025-01-25  
**最終更新**: 2025-01-25  
**担当**: AI Assistant  
**承認**: 要ユーザー確認