# 佐渡祭りカレンダー 開発計画と Todo（SSOT）

このドキュメントは本プロジェクトの「唯一の真実の情報源（SSOT: Single Source of Truth）」です。計画・仕様・タスクの追加/変更は必ず本書を更新してから実装に着手します。

最終更新: 2025-09-17

---

## 強い運用ルール（必読・厳守）
- 本書がプロジェクト計画の SSOT。ここに未反映の仕様での実装は禁止。
- 実装前に: 該当セクション（フェーズ/タスク/仕様）を更新 → オーナーが承認 → 実装開始。
- 変更要求は Issue/PR とひも付け、該当行にリンクを明記。
- PR には本書の対象タスク ID を必ず記載し、完了時にチェックを反映。
- 完了後は実績（所要、差分、注意点）を Decision Log に追記。
- 例外運用は事前合意のうえ Decision Log に根拠を記録。

---

## 5つの実装フェーズ（上位計画）
1) Phase 1: 基盤改修（設定・データ構造・ナビゲーション）
2) Phase 2: UI/UX改修（ダッシュボード・カレンダー・ハイブリッドビュー）
3) Phase 3: 検索・フィルター強化（タグフィルター・重み付けソート）
4) Phase 4: デザイン・スタイル改修（カラー・フォント・UI統一）
5) Phase 5: 地図機能調整・最適化

---

## 主要な変更点（方向性）
- ドメイン: クラフトビール → お祭り・イベント情報
- 新機能: カレンダービュー、ダッシュボード、イベント重み付け
- UI刷新: 新しいカラーパレット、タグフィルター強化
- データ構造: 店舗データ → イベントデータ（Pwamap.FestivalData）

参照:
- CSV フィールド仕様: docs/CSV配列構造.md
- イベント表示計画: docs/event-display-implementation-plan.md

---

## 想定スケジュール（WBS）
- 総工期: 4週間 / 80–100時間
- リリースフロー: 開発 → ステージング → 本番（段階的）
- 目安:
  - 週1: Phase 1 完了（データ/ナビ基盤の可視化と最低限の検索）
  - 週2: Phase 2（ダッシュボード原型・カレンダービューβ）
  - 週3: Phase 3（検索・フィルター・重み付け）
  - 週4: Phase 4–5（デザイン統一・地図最適化）

---

## Definition of Done（各フェーズ共通）
- 型安全（TS strict）かつ ESLint/Prettier 準拠。
- 主要ユースケースの手動確認 + 最低限のユニットテスト（後続で拡張）。
- パフォーマンス劣化なし（Lighthouse 退行がないこと）。
- アクセシビリティ回帰なし（基礎的 ARIA/キーボード操作確認）。
- ドキュメント（本書/関連 docs）更新済み。

---

## Phase 1: 基盤改修（詳細タスク）
状態凡例: [ ] 未着手 / [~] 進行中 / [x] 完了

完了済:
- [x] 型移行: ShopData → FestivalData への統一
- [x] 型の整合: SearchResultsPanel.tsx / SearchResultItem.tsx / Events.tsx の整合
- [x] 仕様化: CSV フィールド仕様（docs/CSV配列構造.md）

未了タスク（本フェーズの最優先）:
- [ ] T1: CSV パーサを「ヘッダ名基準」で実装（列順非依存）
  - 受入条件: ヘッダ変動や列追加でも動作、詳細タグの分割（最大8）と緯度経度の型整合（内部 string）
- [ ] T2: 開催ステータス（開催予定/中止/休止/廃止/過去の開催）での検索・フィルター
  - 受入条件: UI から複数選択フィルター可、URL クエリ/状態保持（再表示時に維持）
- [ ] T3: リッチ情報の UI 反映（写真5枚・詳細タグ・規模感）
  - 受入条件: 写真ギャラリー（サムネ/ライトボックス）、タグバッジ、規模感の視覚化（★やバー）
- [ ] T4: Tabbar.tsx のナビゲーション更新（佐渡祭りカレンダー仕様）
  - 受入条件: 主要タブ構成の確定と文言/アイコン更新、ルーティング動作
- [ ] T5: フェーズ完了ビルドテスト（lint/test/build 通過）

備考: 実装順は T1 → T2 → T3 → T4 → T5 を基本。

---

## Phase 2: UI/UX改修（要点・草案）
- ダッシュボード（今週/今月/注目イベント）
- カレンダー（範囲選択、開催ステータスのオーバーレイ）
- ハイブリッドビュー（地図 + リスト）

---

## Phase 3: 検索・フィルター強化
- タグフィルター（AND/OR 切替）
- 重み付けソート（開催ステータス/規模感/近日性/人気指標の合成）

---

## Phase 4: デザイン・スタイル改修
- カラーパレット刷新、フォント/コンポーネントの統一、テーマ変数整理

---

## Phase 5: 地図機能調整・最適化
- クラスタリング、現在地連動、遅延ロードとキャッシュ調整

---

## Decision Log（決定・変更履歴の要点）
- 2025-09-17: CSV は「列名基準」でパースする。詳細タグは最大 8 に展開。緯度/経度は内部 string。
- 2025-09-17: ShopData を全面廃止し FestivalData 統一。

---

## 現在の着手優先度（直近アクション）
1) T1: CSV パーサ（ヘッダ名基準）
2) T2: 開催ステータスの検索/フィルター
3) T3: リッチ情報の UI 反映
4) T4: Tabbar 更新
5) T5: Phase 1 ビルドテスト