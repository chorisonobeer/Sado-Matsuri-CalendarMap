# フィルタリング機能サンプル分析結果

## 1. 概要

ユーザーから提供されたフィルタリング機能付きHTMLサンプルコードを分析し、現在のダッシュボード画面作成計画との違いや参考になる点を検討した結果をまとめる。

## 2. サンプルコードの主要機能

### 2.1. 技術スタック
- **HTML5** + **TailwindCSS** + **Vanilla JavaScript**
- **Google Maps JavaScript API**（Embed APIではなく正式なJavaScript API）
- **Font Awesome** アイコン
- **レスポンシブデザイン**（max-width: 600px）

### 2.2. 実装されている機能

#### A. 検索・フィルタリング機能
```javascript
// キーワード検索
const matchesSearch = searchText === '' || 
  festival.name.toLowerCase().includes(searchText) || 
  festival.tags.some(tag => tag.toLowerCase().includes(searchText));

// タグフィルタリング
const matchesTag = selectedTags.every(tag => 
  festival.tags.map(t => t.toLowerCase()).includes(tag.toLowerCase()));
```

#### B. ビュー切り替え機能
- **地図ビュー** ⇔ **リストビュー** のタブ切り替え
- 両ビューでフィルタリング結果が連動

#### C. 地図機能（重要な違い）
```javascript
// Google Maps JavaScript API使用
const marker = new google.maps.Marker({
    position: { lat: festival.lat, lng: festival.lng },
    map: map,
    title: festival.name,
    animation: google.maps.Animation.DROP,  // ★アニメーション
});
```

#### D. モーダル表示
- カードクリック時とマーカークリック時の両方で同じモーダルを表示
- 画像、タイトル、日時、説明、タグ、外部リンクを表示

## 3. 現在のプランとの比較

### 3.1. 共通点
| 項目 | 現在のプラン | サンプルコード | 状況 |
|------|-------------|---------------|------|
| レイアウト構成 | 2/3 + 1/3 分割 | 地図⇔リスト切り替え | **異なる** |
| カードデザイン | TailwindCSS準拠 | TailwindCSS使用 | **同じ** |
| モーダル機能 | 詳細表示 | 詳細表示 | **同じ** |
| データ構造 | FestivalData型 | 類似のfestivals配列 | **類似** |

### 3.2. 重要な違い

#### A. 地図実装方式
| 項目 | 現在のプラン | サンプルコード |
|------|-------------|---------------|
| API | Google Maps Embed API | Google Maps JavaScript API |
| ピン表示 | CSS絶対位置（静的） | Marker API（動的） |
| アニメーション | なし | DROP アニメーション ★ |
| インタラクション | なし | マーカークリック可能 |

#### B. フィルタリング機能
| 項目 | 現在のプラン | サンプルコード |
|------|-------------|---------------|
| 検索機能 | **未実装** | **キーワード検索あり** ★ |
| タグフィルタ | **未実装** | **タグボタンフィルタあり** ★ |
| 連動表示 | **未実装** | **地図・リスト連動** ★ |

#### C. UI/UX設計
| 項目 | 現在のプラン | サンプルコード |
|------|-------------|---------------|
| ビュー構成 | 同時表示（2/3 + 1/3） | 切り替え表示 |
| タップ判定 | 1回→ピン、2回→モーダル | 1回→モーダル |
| カード選択 | 選択状態表示 | ホバーエフェクトのみ |

## 4. 参考になる実装パターン

### 4.1. フィルタリングロジック ★★★
```javascript
const filterFestivals = () => {
    const searchText = searchBox.value.toLowerCase();
    const selectedTags = Array.from(tagButtons)
        .filter(btn => btn.classList.contains('selected'))
        .map(btn => btn.dataset.tag);
    
    const filtered = festivals.filter(festival => {
        const matchesSearch = /* 検索条件 */;
        const matchesTag = /* タグ条件 */;
        return matchesSearch && matchesTag;
    });

    // 連動して表示を更新
    renderMarkers(filtered);
    renderCards(filtered);
};
```

### 4.2. 動的マーカー管理 ★★★
```javascript
const renderMarkers = (data) => {
    // 既存マーカーをクリア
    markers.forEach(marker => marker.setMap(null));
    markers = [];
    
    // 新しいマーカーを追加（アニメーション付き）
    data.forEach(festival => {
        const marker = new google.maps.Marker({
            position: { lat: festival.lat, lng: festival.lng },
            map: map,
            title: festival.name,
            animation: google.maps.Animation.DROP,
        });
        markers.push(marker);
    });
};
```

### 4.3. タグボタンの状態管理 ★★
```javascript
tagButtons.forEach(button => {
    button.addEventListener('click', () => {
        if (button.dataset.tag === 'すべて') {
            // 全選択解除
            tagButtons.forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
        } else {
            // 個別選択切り替え
            document.querySelector('[data-tag="すべて"]').classList.remove('selected');
            button.classList.toggle('selected');
        }
        filterFestivals();
    });
});
```

## 5. 現在のプランへの影響と推奨事項

### 5.1. 採用を推奨する機能

#### A. フィルタリング機能の追加 ★★★
- **キーワード検索**: イベント名・タグでの検索
- **タグフィルタ**: カテゴリ別フィルタリング
- **連動表示**: フィルタ結果に応じた地図ピン更新

#### B. 地図実装方式の見直し ★★★
- **Google Maps JavaScript API**: より柔軟な制御が可能
- **DROP アニメーション**: フィルタ時のピン表示が視覚的に分かりやすい
- **マーカークリック**: 地図からも詳細表示可能

### 5.2. 現在のプランを維持すべき点

#### A. レイアウト構成
- **2/3 + 1/3 同時表示**: 要件定義書に明記されている
- **2列グリッド**: モバイル対応として適切

#### B. タップ判定ロジック
- **1回→ピン、2回→モーダル**: 要件定義書の仕様
- **lastClickedCardId**: 実装済みの判定方式

## 6. 実装プランの修正提案

### 6.1. 追加すべきコンポーネント
1. **SearchBox.tsx**: キーワード検索コンポーネント
2. **TagFilter.tsx**: タグフィルタリングコンポーネント
3. **FilterProvider.tsx**: フィルタ状態管理コンテキスト

### 6.2. 修正すべき技術仕様
1. **地図API**: Embed API → JavaScript API
2. **ピン表示**: 静的CSS → 動的Marker
3. **データフロー**: フィルタリング機能の追加

### 6.3. 段階的実装アプローチ
1. **Phase 1**: 基本ダッシュボード（現在のプラン通り）
2. **Phase 2**: フィルタリング機能追加
3. **Phase 3**: 地図API移行（アニメーション対応）

## 7. 結論

### 7.1. 主要な発見
- サンプルコードは**フィルタリング機能**と**動的地図表示**に優れている
- 現在のプランは**要件定義書準拠**だが、**UX向上の余地**がある
- 両方の良い点を組み合わせることで、より完成度の高いダッシュボードが実現可能

### 7.2. 推奨アクション
1. **現在のプラン**で基本実装を完了
2. **フィルタリング機能**を段階的に追加
3. **地図API移行**を将来的な改善として検討

### 7.3. 次のステップ
- ユーザーとの機能追加に関する相談
- フィルタリング機能の要件定義
- 地図API移行の技術的検討